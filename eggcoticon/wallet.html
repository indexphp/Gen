<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PONY NFT Manager - SmartBCH</title>

<!meta property="og:image" content="https://ba.net/pony/icon-small.png">

    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.1/web3.min.js"
        integrity="sha512-96ZCo0pzD4x2MuBZCB4ipirFKs/X/xB2diGU/A7zpfaltISM309KN79pyWe4l9IdtOlzitRltfVcxgdTEbcnvQ=="
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>


<div align=right>
<table cellpadding=5>
<td>
<a href="https://ba.net/pony-smartbch">
<img src="https://ba.net/gifs/unicorn.png" width=30 height=30
align=left border=0>
</a>
<td>
<a href="https://ba.net/pony-smartbch/nft/wallet.html">
<img src=/gifs/wallet.png width=30 height=30 title="pony wallet"></a>
<td>
<button id="button4" class="btn-sm btn-secondary">Connect Metamask</button>
<td>
<div class="custom-control custom-switch">
  <input type="checkbox" class="custom-control-input" id="darkSwitch">
  <label class="custom-control-label" for="darkSwitch">
<img src=dark.png width=30 height=30>
</label>
<div>
</table>
</div>

<style>
        body {
               background: #F5F0F2;
}

[data-theme="dark"] {
  background-color: #111 !important;
  color: #eee;
}

[data-theme="dark"] .bg-black {
  background-color: #fff !important;
}

[data-theme="dark"] .bg-dark {
  background-color: #eee !important;
}

[data-theme="dark"] .bg-light {
  background-color: #222 !important;
}
</style>

<body>

    <div class="container">
<center>
<p><br>
<table cellpadding=10><td>
<a href="https://ba.net/smartbch/metamask.html" target=_blank>
<img src="https://ba.net/gifs/metamask2.png" width=45 height=45
align=left border=0 title="install metamask extension">
</a>
<td>
<a href="https://ba.net/smartbch/metamask.html" target=_blank>
<img src="https://ba.net/gifs/smartbch2.png" width=45 height=45
align=left border=0 title="smartbch metamask config">
</a>
<td>
<a href="https://ba.net/pony-smartbch/business.html">
<img src="https://ba.net/gifs/shop-small.png" width=45 height=45
align=left border=0></a>
<td>
<a href="https://ba.net/pony-smartbch">
<img src="https://ba.net/pony/icon-small.png" width=75 height=75
align=left border=0 title="PONY NFT Exchange">
</a>

<td>
        <h3>PONY NFT Manager</h3>
SmartBCH
</table>
<p><br>

       <div class="mb-3">

<p><br><br>


        <button id="button2" class="btn btn-primary">View Your Ponies</button>

<p>
<div class="mb-3">
<div id="lang">
</div>
</div>


<p><br>
<p><br>
<table>
<td><label for="name" class="col-lg-2 form-label">Pony ID</label>
<td><input id="ponyid" size="6" type="text" placeholder="123">

<tr>
<td><label for="name" class="col-lg-2 form-label">Send To Address</label>
<td><input id="address" size="52" type="text" placeholder="0x...">
</table>	    
</div>


<p><br>
        <button id="button" class="btn btn-primary">Transfer Pony</button>


</div>

<center>

<p><br><br>
You can also view your ponies in the Metamask App for Mobile
<br>directly inside the collectible tab
<br>0x1aabd375aE6789C4601Dcb96014A6fBd8f9eb40a
<br>enter Pony ID
<br>on Metamask Desktop
<br>enter Decimal 0


<p><br><br><br>
<font size=5>
To sell and price your ponies <a href="https://ba.net/pony-smartbch/sell.html">Seller Manager</a>

<p><br>
You can Buy and Sell ponies at the <a href="https://ba.net/pony-smartbch">
PONY NFT Exchange</a>


<p><br><br>
<p><br><br>
<p><br><br>

<font size=4>
<p><br><br>PONY Contract at 
<a href="https://smartscan.cash/address/0x1aabd375aE6789C4601Dcb96014A6fBd8f9eb40a" target=_blank>0x1aabd375aE6789C4601Dcb96014A6fBd8f9eb40a</a>

<p><br><br>


<br><br>


    <script>

var darkSwitch=document.getElementById("darkSwitch");window.addEventListener("load",(function(){if(darkSwitch){initTheme();darkSwitch.addEventListener("change",(function(){resetTheme()}))}}));function initTheme(){var darkThemeSelected=localStorage.getItem("darkSwitch")!==null&&localStorage.getItem("darkSwitch")==="dark";darkSwitch.checked=darkThemeSelected;darkThemeSelected?document.body.setAttribute("data-theme","dark"):document.body.removeAttribute("data-theme")}function resetTheme(){if(darkSwitch.checked){document.body.setAttribute("data-theme","dark");localStorage.setItem("darkSwitch","dark")}else{document.body.removeAttribute("data-theme");localStorage.removeItem("darkSwitch")}}


web3 = new Web3(web3.currentProvider);
ethereum.enable();

//no auto connect
ethereum.request({ method: 'eth_requestAccounts' });

        if (typeof web3 !== 'undefined') {
            console.log("Using current provider")
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            web3 = new Web3(new Web3.providers.HttpProvider("https://fayclz18xahk.usemoralis.com:2053/server"));
//            console.log("Using ganache (localhost)");
        }
</script>

<script src=contract.js></script>

<script>
        var cuentaMaster;
        const getAccount = async () => {
            try {
                const myAccounts = await web3.eth.getAccounts();
                cuentaMaster = myAccounts[0];
                console.log("Master account " + cuentaMaster);
                return myAccounts[0];

            } catch (err) {
                console.log(err);
            }
        }

        getAccount();
        web3.eth.defaultAccount = web3.eth.accounts[0];


        $("#button4").click(function () {
            console.log("Master = " + cuentaMaster);

//force login ok
ethereum.request({ method: 'eth_requestAccounts' });

        if (typeof web3 !== 'undefined') {
            console.log("Using current provider")
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            web3 = new Web3(new Web3.providers.HttpProvider("https://fayclz18xahk.usemoralis.com:2053/servert"));
//            console.log("Using ganache (localhost)");
        }


})



        $("#button2").click(function () {
            console.log("Master = " + cuentaMaster);

//if not connected reload page
//if (!cuentaMaster) location.reload(true);

if (!cuentaMaster) {
document.getElementById('button4').click();
location.reload(true);
}

contract.methods.balanceOf(cuentaMaster).call({ from: cuentaMaster })
                .then(function (result) {
 var content = "<p><br>PONY total ";
content += result + "<br>";
//content += " "+cuentaMaster;
//$("#lang").html(content);

balance = result;

//content += "<br><table>";
for(var x = 0; x < balance; x++){

contract.methods.tokenOfOwnerByIndex(cuentaMaster, x).call({ from: cuentaMaster, gasPrice: 500000000 })
                .then(function (result) {

contract.methods.tokenURI(Number(result)).call()
                .then(function (result1) {

//if (content.length > 500 && content.length < 600) content += "<tr>";
//if (content.length > 900 && content.length < 1000) content += "<tr>";
if (content.length > 1000 && content.length < 5000) content += "<tr>";

$.getJSON(result1, function (data) {
content += "<td>"+content.length;
content += "<!br>TokenId "+result +" ";
content += "<!td><img src="+data.image+" width=150 height=150>";

                                               
$("#lang").html(content);
});

});

});

//x++;
} // for

$("#lang").html(content);

});

        });




        $("#button").click(function () {
            console.log("Master = " + cuentaMaster);
            var ponyid = $("#ponyid").val();
            var address = $("#address").val();


//if not connected reload page
if (!cuentaMaster) location.reload(true);

var content = "<p><br>Sending transaction...";
$("#lang").html(content);

var event = contract.methods.safeTransferFrom(cuentaMaster,address, ponyid).send({ from: cuentaMaster, gasPrice: 500000000 })
                .then(function (receipt) {
                    // will be fired once the receipt is mined
                    console.log(receipt);
//alert(JSON.stringify(receipt));

var content = "<p><br><br>Transaction sent!<br>";
content += JSON.stringify(receipt.transactionHash);
//document.write(content);
$("#lang").html(content);

                });;

        });
    </script>

</body>

</html>
